# Этап 5
- [Оглавление](https://github.com/fedy95/Visualization-with-OpenGL/blob/master/README.md);
- [Код](https://github.com/fedy95/Visualization-with-OpenGL/blob/master/step5.py).

## Задача
- Вычислить нормали к водной поверхности.
- Реализовать затенение по Фонгу с одним направленным источником света (Солнце) и рассеянным светом.

## Теория

Выделяют три типа освещения:
- ambient light: окружающее естественное освещение, рассеянный свет (грубо говоря, Directional + Point lights);
- directional light: направленный свет (солнечный свет);
- point light: точечный свет (свет лампы).

![step5_theory1](https://github.com/fedy95/Visualization-with-OpenGL/blob/master/images/step5_theory1.png)

Важно правильно подойти к освещаемому материалу, так как очевидно, что в реальной жизни взаимодействие света и материала дает различные эффекты (например, дерево и металл значительно отличаются при одинаковом освещении).

Освещение объекта непосредственно связано с понятием нормали.

Нормаль - вектор, перпендикулярный освещаемый поверхности.

Нормаль является результатом векторного произведение векторов (в нашем случае векторы это стороны простейшего полигона - треугольника).

![step5_theory2](https://github.com/fedy95/Visualization-with-OpenGL/blob/master/images/step5_theory2.png)

При создании модели освещения необходимо выбрать:
- lighting model (модель освещения/отражения) (в нашем случае в большей степени направленный свет (Солнце));
- shading model (модель затенения) (в нашем случае затенение по Фонгу).

Модель освещения - способ взаимодействия материалов и света для получения финального значения цвета объекта.

Модель затенения - тип интерполяции, с помощью которого возможно получить конечное значение цвета объекта в зависимости от освещения. 

Необходимо установить в шейдерах следующие объекты:
- матрицу нормалей;
- нормали вершины;
- направления света и световые точки;
- цвета освещения.

Например, возьмем пиксель на этом полигоне (красная точка). 

Вектор нормали, соответствующий этому пикселю на поверхности — **n**. 

Свет падает на полигон вдоль вектора **l**. 

Скалярное произведение векторов - количество света, отраженного от данного пикселя. Существуют два способа его подсчета:

![nl=n_xl_x+n_yl_y+n_zl_z](http://latex.codecogs.com/svg.latex?%5Cfn_jvn%20nl%3Dn_xl_x&plus;n_yl_y&plus;n_zl_z)

![nl=\left | n \right |\left | l \right |*cos(\theta)](http://latex.codecogs.com/svg.latex?%5Cfn_jvn%20nl%3D%5Cleft%20%7C%20n%20%5Cright%20%7C%5Cleft%20%7C%20l%20%5Cright%20%7C*cos%28%5Ctheta%29)

Проще проводить расчет со вторым выражением, так как он оперирует с длинами векторов и углом между ними.
- величина нормали к поверхности равна 1;
- величина вектора падающего света приводится к 1 и будет иметь значения от 0 до 1 (1 самый яркий свет).

![step5_theory3](https://github.com/fedy95/Visualization-with-OpenGL/blob/master/images/step5_theory3.gif)

Цвет представляется как сумма рассеянного и направленного света.

## Результат

![step5_result](https://github.com/fedy95/Visualization-with-OpenGL/blob/master/images/step5_result.gif)

